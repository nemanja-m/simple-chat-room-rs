<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Hello!</title>
    <script>
        function login() {
            let existingUser = sessionStorage.getItem('user');
            if (existingUser) {
                document.getElementById('user').textContent = existingUser;
                let logoutButton = document.getElementById('logoutButton');
                logoutButton.style.display = 'block';
                return;
            }

            let username = prompt('What is your name?');
            if (username === null) {
                username = 'User #' + Math.floor(1000 + Math.random() * 9000);
            }

            fetch('/users', {
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                method: 'POST',
                body: new URLSearchParams({
                    username
                }),
            })
                .then(response => response.text())
                .then(user => {
                    document.getElementById('user').textContent = user;
                    sessionStorage.setItem('user', user);

                    let logoutButton = document.getElementById('logoutButton');
                    logoutButton.style.display = 'block';
                });
        }

        function logout() {
            sessionStorage.removeItem('user');
            location.reload();
            return false;
        }

        document.addEventListener('DOMContentLoaded', login, false);
    </script>
</head>

<body style="display:flex; flex-direction:column; justify-content:start; align-items:center; min-height:100vh;
    font-size:24px;">
    <div style="display:flex; flex-direction:column; justify-content:center;">
        <p>Hello, <span id="user"></span>!</p>
        <button id="logoutButton" onClick=logout() hidden>Logout</button>
    </div>
    <div>
        <ul>
            <li>Test</li>
            <li>Test</li>
            <li>Test</li>
        </ul>
    </div>
</body>

</html>